<section class="home">
  <!-- Filters row -->
  <div class="filters">
    <!-- M√™s: por enquanto s√≥ reseta tudo (igual seu bot√£o) -->
    <button class="pill pill--soft" type="button" (click)="limparTodosFiltros()">
      <span class="pill__icon">üìÖ</span>
      {{ mesLabel }}
      <span class="pill__chev">‚ñæ</span>
    </button>

    <!-- Categoria (multi) - clique alterna uma categoria demo -->
    <button
      class="pill"
      type="button"
      (click)="toggleCategoria('Alimenta√ß√£o')"
      [class.pill--active]="categoriaAtiva('Alimenta√ß√£o')"
    >
      Categoria: {{ filtroCategoriaLabel }}
      <span class="pill__x" (click)="limparFiltroCategoria(); $event.stopPropagation()">√ó</span>
    </button>

    <!-- Tipo (multi) - clique alterna Entrada demo -->
    <button
      class="pill"
      type="button"
      (click)="toggleTipo('entrada')"
      [class.pill--active]="tipoAtivo('entrada')"
    >
      Tipo: {{ filtroTipoLabel }}
      <span class="pill__x" (click)="limparFiltroTipo(); $event.stopPropagation()">√ó</span>
    </button>

    <button
      class="pill"
      type="button"
      (click)="toggleValor(100, 500)"
      [class.pill--active]="valorAtivo(100, 500)"
    >
      Valor: {{ filtroValorLabel }}
      <span class="pill__x" (click)="limparFiltroValor(); $event.stopPropagation()">√ó</span>
    </button>

    <button class="pill" type="button" (click)="limparTodosFiltros()">
      Limpar <span class="pill__chev">‚Ü∫</span>
    </button>
  </div>

  <!-- KPI cards -->
  <div class="kpi-grid">
    <!-- Saldo -->
    <article class="kpi-card">
      <div class="kpi-card__row">
        <div class="kpi-card__left">
          <div class="kpi-ico kpi-ico--blue">üí≥</div>

          <div class="kpi-card__text">
            <div class="kpi-label">Saldo total</div>

            <ng-container *ngIf="(visibility.showBalances$ | async); else hiddenSaldo">
              <div class="kpi-value">{{ saldoTotal }}</div>
            </ng-container>

            <ng-template #hiddenSaldo>
              <div class="kpi-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            </ng-template>
          </div>
        </div>

        <div class="kpi-card__chev">‚Ä∫</div>
      </div>

      <div class="kpi-bar">
        <div class="kpi-bar__fill" [style.width.%]="clampPercent(metaProgress)"></div>
      </div>
    </article>

    <!-- Metas criadas (substitui "Meta de guardar") -->
    <article class="kpi-card kpi-card--clickable" (click)="irParaMetas()" role="button" tabindex="0">
      <div class="kpi-card__row">
        <div class="kpi-card__left">
          <div class="kpi-ico kpi-ico--pink">üéØ</div>

          <div class="kpi-card__text">
            <div class="kpi-label">Metas criadas</div>

            <button class="kpi-button" type="button" (click)="irParaMetas(); $event.stopPropagation()">
              <span class="kpi-value">{{ metasCriadas }}</span>
            </button>
          </div>
        </div>

        <div class="kpi-card__chev">‚Ä∫</div>
      </div>

      <!-- barra opcional -->
      <div class="kpi-bar">
        <div class="kpi-bar__fill" [style.width.%]="clampPercent(metasBarPercent)"></div>
      </div>

      <!-- <div class="kpi-foot">
        <span class="kpi-foot__muted">Total</span>
        <span class="kpi-foot__val">{{ metasCriadas }}</span>
      </div> -->
    </article>

    <!-- Gasto no m√™s -->
    <article class="kpi-card">
      <div class="kpi-card__row">
        <div class="kpi-card__left">
          <div class="kpi-ico kpi-ico--orange">üõ©Ô∏è</div>

          <div class="kpi-card__text">
            <div class="kpi-label">Gasto no m√™s</div>

            <ng-container *ngIf="(visibility.showBalances$ | async); else hiddenGasto">
              <div class="kpi-value kpi-value--neg">{{ gastoNoMes }}</div>
              <div class="kpi-sub">
                <span class="kpi-sub__up">‚ñ≤ 9%</span>
                <span class="kpi-sub__muted">que Dezembro</span>
              </div>
            </ng-container>

            <ng-template #hiddenGasto>
              <div class="kpi-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            </ng-template>
          </div>
        </div>

        <div class="kpi-card__chev">‚Ä∫</div>
      </div>
    </article>
  </div>

  <!-- Main grid -->
  <div class="grid">
    <article class="ui-card ui-card--list">
      <header class="ui-card__head">
        <div>
          <div class="ui-card__title">√öltimas Transa√ß√µes</div>
          <div class="ui-card__sub">{{ totalUltimasLabel }}</div>
        </div>

        <div class="ui-card__right">
          <div class="ui-card__sum">{{ totalUltimasValor }}</div>
          <div class="ui-card__chev">‚ñæ</div>
        </div>
      </header>

      <div class="ui-list">
        <ng-container *ngFor="let tx of txs; trackBy: trackById; let i = index">
          <div class="ui-list__group" *ngIf="i === 0 || txs[i - 1].groupLabel !== tx.groupLabel">
            <span>{{ tx.groupLabel }}</span>
          </div>

          <div class="ui-row">
            <div class="ui-row__left">
              <div class="ui-row__ico">{{ tx.icon }}</div>

              <div class="ui-row__text">
                <div class="ui-row__title">
                  {{ tx.desc }}
                  <span class="ui-tag ui-tag--gray" *ngIf="tx.tags?.[0]">{{ tx.tags[0] }}</span>
                </div>

                <div class="ui-row__tags" *ngIf="(tx.tags?.length ?? 0) > 1">
                  <span class="ui-tag ui-tag--orange" *ngFor="let t of tx.tags.slice(1)">{{ t }}</span>
                </div>
              </div>
            </div>

            <div
              class="ui-value"
              [class.ui-value--pos]="(tx.numeric ?? 0) > 0"
              [class.ui-value--neg]="(tx.numeric ?? 0) < 0"
            >
              {{ tx.value }}
            </div>
          </div>
        </ng-container>
      </div>
    </article>
  </div>

  <!-- Floating add button -->
  <button class="fab" type="button" (click)="abrirNovaTransacao()" aria-label="Nova transa√ß√£o">+</button>

  <!-- Modal compartilhado (shared) -->
  <app-tx-modal #txModal (saved)="onTxSaved($event)"></app-tx-modal>
</section>
